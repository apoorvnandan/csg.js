<!DOCTYPE html>
<html><head>
  <script src="lightgl.js"></script>
  <script src="csg.js"></script>
  <script src="viewer.js"></script>
  <script src="asu/apinatomy2-data.js"></script>
  <script src="asu/repositories.js"></script>
  
  <style>

body {
  font: 14px/20px 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif;
  max-width: 800px;
  margin: 0 auto;
  padding: 50px 50px 200px 50px;
}

pre, code, textarea {
  font: 12px/20px Monaco, monospace;
  border: 1px solid #CCC;
  border-radius: 3px;
  background: #F9F9F9;
  padding: 0 3px;
  color: #555;
}
pre, textarea {
  padding: 10px;
  width: 100%;
}
textarea {
  height: 200px;
}
textarea:focus {
  outline: none;
}

h1, h2 { font: bold 30px/30px 'Helvetica Neue', Helvetica, Arial; }
h2 { font-size: 30px; margin: 100px 0 0 0; }
a {font-size: 30px; color: inherit; }
.viewer { width: 200px; height: 200px; background: #EEE url(images.png); }
#combined .viewer { width: 150px; height: 150px; }
table { border-collapse: collapse; margin: 0 auto; }
td { padding: 5px; text-align: center; }
td code { background: none; border: none; color: inherit; }
canvas { cursor: move; }

  </style>
</head><body>
<a href="tree/lungs.html">3D lungs using ASU</a><br><br>
<a href="asuEditor.html">ASU Editor</a><br><br><br>
<h1>Generating layered tube from asymmetric unit</h1>


<table>
    
    <tr>
      <td><div id="0" class="viewer" style="background-image:none;width:600px;height:600px;"></div></td>
    </tr>
  </table>
<pre>
<b>Code:</b> <br> 

function generateTube(asu) {
  
  var tubeRadius = [];
  tubeRadius[0] = 0.4; //radius of the hollow part
  //calculate cylinder radius based on thickness of each layer
  for(var i = 1;i<=asu.getNumberOfLayers();i++) {
    tubeRadius[i] = tubeRadius[i-1] + (asu.layers[i-1].thickness)/10;
  }
  var tube = [];
  for(var i = 0;i<=asu.getNumberOfLayers();i++) {
   tube[i] = CSG.cylinder({ radius: tubeRadius[i], start: [0, -1, 0], end: [0, 1, 0] });
   var rVal, gVal, bVal;
   if(i!=0) {
     rVal = asu.layers[i-1].material.colour.substring(1, 3);
     gVal = asu.layers[i-1].material.colour.substring(3, 5);
     bVal = asu.layers[i-1].material.colour.substring(5, 7);
     tube[i].setColor(Number(rVal)/100, Number(gVal)/100, Number(bVal)/100);
   }
  }
  //combine the cylinders
  var x = tube[1];
  for(var i=2;i<=asu.getNumberOfLayers();i++) {
    x = x.union(tube[i]);
  }
  x = x.subtract(tube[0]); //to make the cylinder hollow
  addViewer(new Viewer(x, 400, 400, 4));

}

generateTube(au);

//Asymmetric Unit used:  "Gastrointestinal tract" as created in repositories.js.
var layers = [
    new Layer("l:001", "Chyme/Chyle", 1, materialRepo.materials[0]),
    new Layer("l:002", "Mucosa", 1, materialRepo.materials[1]),
    new Layer("l:003", "Submucosa", 1, materialRepo.materials[2]),
    new Layer("l:004", "Internal Muscle", 1, materialRepo.materials[3]),
    new Layer("l:005", "External Muscle", 1, materialRepo.materials[4]),
    new Layer("l:006", "Serosa", 1, materialRepo.materials[5])];

//1
var au = new AsymmetricUnit("au:001", "Gastrointestinal tract", layers, 1);


</pre>
<script>


function generateTube(asu) {
  
  var tubeRadius = [];
  tubeRadius[0] = 0.4; //radius of the hollow part
  //calculate cylinder radius based on thickness of each layer
  for(var i = 1;i<=asu.getNumberOfLayers();i++) {
    tubeRadius[i] = tubeRadius[i-1] + (asu.layers[i-1].thickness)/10;

  }
  var tube = [];
  for(var i = 0;i<=asu.getNumberOfLayers();i++) {
   tube[i] = CSG.cylinder({ radius: tubeRadius[i], start: [0, -1, 0], end: [0, 1, 0] });
   var rVal, gVal, bVal;
   if(i!=0) {
     rVal = asu.layers[i-1].material.colour.substring(1, 3);
     gVal = asu.layers[i-1].material.colour.substring(3, 5);
     bVal = asu.layers[i-1].material.colour.substring(5, 7);
     tube[i].setColor(Number(rVal)/100, Number(gVal)/100, Number(bVal)/100);
   }
  }

  //combine the cylinders
  var x = tube[1];
  for(var i=2;i<=asu.getNumberOfLayers();i++) {
    x = x.union(tube[i]);
  }
  x = x.subtract(tube[0]); //to make the cylinder hollow

  addViewer(new Viewer(x, 400, 400, 4));

}


generateTube(au);



</script>
</body></html>
